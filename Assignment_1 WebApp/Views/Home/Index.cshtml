@using Assignment_1_API.Models
@model List<Order>
@{
    ViewData["Title"] = "Home Page";
}

<h2>Orders List</h2>

<form method="Get" asp-action="Index" asp-controller="Home" style="display: flex; align-items: center;">
    <div class="form-group mb-2 mr-2" style="display: flex; align-items: center;">
        <label for="startDate" class="mr-2" style="margin-right: 5px;">Start Date</label>
        <input type="date" id="startDate" name="startDate" class="form-control" style="margin-right: 10px;" value="@ViewData["startDate"]" />
    </div>
    <div class="form-group mb-2 mr-2" style="display: flex; align-items: center;">
        <label for="endDate" class="mr-2" style="margin-right: 5px;">End Date</label>
        <input type="date" id="endDate" name="endDate" class="form-control" style="margin-right: 10px;" value="@ViewData["endDate"]" />
    </div>
    <button type="submit" class="btn btn-primary mb-2" style="height: 38px;">Search</button>
</form>


<table class="table" border="1" style="width: 100%; border-collapse: collapse; text-align: left; margin-top: 20px;">
    <thead style="background-color: #f2f2f2;">
        <tr>
            <th style="padding: 10px; border: 1px solid #ddd;">Order ID</th>
            <th style="padding: 10px; border: 1px solid #ddd;">Order Date</th>
            <th style="padding: 10px; border: 1px solid #ddd;">Staff ID</th>
            <th style="padding: 10px; border: 1px solid #ddd;">Action</th>
        </tr>
    </thead>
    <tbody>
        @* @foreach (var item in Model)
        {
            <tr style="border: 1px solid #ddd;">
                <td style="padding: 10px; border: 1px solid #ddd;">@item.OrderId</td>
                <td style="padding: 10px; border: 1px solid #ddd;">@item.OrderDate.ToString("yyyy-MM-dd")</td>
                <td style="padding: 10px; border: 1px solid #ddd;">@item.StaffId</td>
                <td style="padding: 10px; border: 1px solid #ddd;">
                    <a asp-action="ReportDetail" asp-controller="Home" asp-route-orderId="@item.OrderId">Detail</a>
                </td>
            </tr>
        } *@
    </tbody>
</table>



<script>
    ShowOrders();

    function ShowOrders() {
        const startDate = document.getElementById('startDate').value;
        const endDate = document.getElementById('endDate').value;

        let url = 'https://localhost:7271/api/Report';

        if (startDate || endDate) {
            url += `?StartDate=${startDate}&EndDate=${endDate}`;
        }

        let tbody = document.querySelector("tbody");
        tbody.innerHTML = "";
        fetch(url)
            .then(res => res.json())
            .then(data => data.forEach(item => {
                let orderDate = new Date(item.orderDate);
                let formattedDate = orderDate.toISOString().split('T')[0];

                console.log(item)
                let html = `<tr>
                        <td>${item.orderId}</td>
                        <td>${formattedDate}</td>
                        <td>${item.staffId}</td>
                            <td><a href="/Home/ReportDetail?orderId=${item.orderId}">Detail</a></td>
                    </tr>`
                tbody.innerHTML += html;
            }))
            .catch(error => {
                alert('Error fetching data: ' + error.message);
                console.error('There was a problem with the fetch operation:', error);
            });
    }
</script>


